(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9056],{52883:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eF});var s=a(95155),r=a(12115),n=a(31530),l=a(62741),d=a(14913),i=a(2145),c=a(17990),o=a(77196),m=a(68183),x=a(84661),u=a(13244),y=a(35883),b=a(67622),p=a(14493);let g=JSON.parse('{"HV":[{"inputs":[],"name":"CannotReimburse","type":"error"},{"inputs":[],"name":"InvalidPayee","type":"error"},{"inputs":[],"name":"NotPayee","type":"error"},{"inputs":[],"name":"NotPayer","type":"error"},{"inputs":[],"name":"NothingToClaim","type":"error"},{"inputs":[],"name":"PaymentAlreadyExists","type":"error"},{"inputs":[],"name":"ReentrancyGuardReentrantCall","type":"error"},{"inputs":[],"name":"TransferFailed","type":"error"},{"inputs":[],"name":"ZeroAmount","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"by","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"}],"name":"PaymentClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"by","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"}],"name":"PaymentReimbursed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"}],"name":"PaymentSent","type":"event"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"getPaymentDetails","outputs":[{"internalType":"address","name":"payer","type":"address"},{"internalType":"address","name":"payee","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"createdAt","type":"uint256"},{"internalType":"string","name":"status","type":"string"},{"internalType":"address","name":"tokenAddress","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"paymentExists","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"payments","outputs":[{"internalType":"address","name":"payer","type":"address"},{"internalType":"address","name":"payee","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"createdAt","type":"uint256"},{"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"internalType":"uint8","name":"status","type":"uint8"},{"internalType":"address","name":"tokenAddress","type":"address"},{"internalType":"bool","name":"exists","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"reimburse","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"internalType":"address","name":"payee","type":"address"},{"internalType":"address","name":"tokenAddress","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"sendERC20","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"internalType":"address","name":"payee","type":"address"}],"name":"sendETH","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusAsString","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusIsClaimed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusIsReimbursed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusIsSent","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"}]}');var h=a(21988);let f="0x0000000000000000000000000000000000000000",v={[h.rV.id]:"",[h.D8.id]:"",[h.Ks.id]:"",[h.n1.id]:"",[h.mZ.id]:"",[h.Rr.id]:"",[h.ac.id]:"",[h.pz.id]:"0x2c137aC6Bc804A9F798053347802F489F0025768",[h.nM.id]:"0xCd0e744c171810b45567Ad458C0601b349a8f360",[h.cF.id]:""},j={[h.n1.id]:[{symbol:"MATIC",address:"0x0000000000000000000000000000000000001010",decimals:18,priceFeed:"0xAB594600376Ec9fD91F8e885dADF0CE036862dE0"},{symbol:"USDT.pos",address:"0xc2132D05D31c914a87C6611C10748AEb04B58e8F",decimals:6,priceFeed:"0x0A6513e40db6EB1b165753AD52E80663aeA50545"},{symbol:"USDT",address:"0x9417669fBF23357D2774e9D421307bd5eA1006d2",decimals:6,priceFeed:"0x0A6513e40db6EB1b165753AD52E80663aeA50545"},{symbol:"USDC",address:"0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359",decimals:6,priceFeed:"0xfE4A8cc5b5B2366C1B58Bea3858e81843581b2F7"},{symbol:"USDC.e",address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",decimals:6,priceFeed:"0x5c3890e86f3E7Ed7F5390532De147953580f1605"}],[h.nM.id]:[{symbol:"MATIC",address:"0x0000000000000000000000000000000000001010",decimals:18,priceFeed:"0x001382149eBa3441043c1c66972b4772963f5D43"},{symbol:"USDT",address:"0x2655783ed6c47Fd312D1204712A804821899E1A3",decimals:6,priceFeed:"0x3aC23DcB4eCfcBd24579e1f34542524d0E4eDeA8"},{symbol:"USDC",address:"0x41E94Eb019C0762f9Bfcf9Fb1E58725BfB0e7582",decimals:6,priceFeed:"0x1b8739bB4CdF0089d07097A9Ae5Bd274b29C6F16"}],[h.D8.id]:[{symbol:"ETH",address:f,decimals:18,priceFeed:"0x639Fe6ab55C921f74e7fac1ee960C0B6293ba612"},{symbol:"WETH",address:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",decimals:18,priceFeed:"0x639Fe6ab55C921f74e7fac1ee960C0B6293ba612"},{symbol:"USDT",address:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9",decimals:6,priceFeed:"0x3f3f5dF88dC9F13eac63DF89EC16ef6e7E25DdE7"},{symbol:"USDC",address:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",decimals:6,priceFeed:"0x50834F3163758fcC1Df9973b6e91f0F0F0434aD3"},{symbol:"USDC.e",address:"0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8",decimals:6,priceFeed:"0x88AC7Bca36567525A866138F03a6F6844868E0Bc"}],[h.rV.id]:[{symbol:"BNB",address:f,decimals:18,priceFeed:"0x0567F2323251f0Aab15c8dFb1967E4e8A7D42aeE"},{symbol:"USDT",address:"0x55d398326f99059fF775485246999027B3197955",decimals:18,priceFeed:"0xB97Ad0E74fa7d920791E90258A6E2085088b4320"},{symbol:"USDC",address:"0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d",decimals:18,priceFeed:"0x51597f405303C4377E36123cBc172b13269EA163"}],[h.Ks.id]:[{symbol:"EDU",address:f,decimals:18},{symbol:"USDT",address:"0x7277Cc818e3F3FfBb169c6Da9CC77Fc2d2a34895",decimals:6},{symbol:"USDC",address:"0x836d275563bAb5E93Fd6Ca62a95dB7065Da94342",decimals:6}],[h.mZ.id]:[{symbol:"AVAX",address:f,decimals:18,priceFeed:"0x0A77230d17318075983913bC2145DB16C7366156"},{symbol:"USDC",address:"0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E",decimals:6,priceFeed:"0xF096872672F44d6EBA71458D74fe67F9a77a23B9"},{symbol:"USDC.e",address:"0xA7D7079b0FEaD91F3e65f86E8915Cb59c1a4C664",decimals:6},{symbol:"USDT",address:"0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7",decimals:6,priceFeed:"0xEBE676ee90Fe1112671f19b6B7459bC678B67e8a"},{symbol:"USDT.e",address:"0xc7198437980c041c805A1EDcbA50c1Ce5db95118",decimals:6},{symbol:"DAI.e",address:"0xd586E7F844cEa2F87f50152665BCbc2C279D8d70",decimals:18}],[h.Rr.id]:[{symbol:"OP",address:"0x4200000000000000000000000000000000000042",decimals:18,priceFeed:"0x0D276FC14719f9292D5C1eA2198673d1f4269246"},{symbol:"ETH",address:f,decimals:6,priceFeed:"0x13e3Ee699D1909E989722E753853AE30b17e08c5"},{symbol:"USDC",address:"0x7F5c764cBc14f9669B88837ca1490cCa17c31607",decimals:6,priceFeed:"0x16a9FA2FDa030272Ce99B29CF780dFA30361E0f3"},{symbol:"USDT",address:"0x94b008aA00579c1307B0EF2c499aD98a8ce58e58",decimals:6,priceFeed:"0xECef79E109e997bCA29c1c0897ec9d7b03647F5E"}],[h.ac.id]:[{symbol:"tBNB",address:f,decimals:18,priceFeed:"0x2514895c72f50D8bd4B4F9b1110F0D6bD2c97526"},{symbol:"USDT",address:"0x337610d27c682e347c9cd60bd4b3b107c9d34ddd",decimals:18,priceFeed:"0xEca2605f0BCF2BA5966372C99837b1F182d3D620"},{symbol:"USDC",address:"0x0a385f86059e0b2a048171d78afd1f38558121f3",decimals:18,priceFeed:"0x90c069C4538adAc136E051052E14c1cD799C41B7"}],[h.pz.id]:[{symbol:"ETH",address:f,decimals:18,priceFeed:"0x4aDC67696bA383F43DD60A9e78F2C97Fbbfc7cb1"},{symbol:"USDC",address:"0x9C868614ffca7da36B36330b1f317B117c7834dE",decimals:6,priceFeed:"0xd30e2101a97dcbAeBCBC04F14C3f624E67A35165"},{symbol:"WETH",address:"0xEa347A7CB535cBE125099A4C3B992149aE08e55d",decimals:18,priceFeed:"0x4aDC67696bA383F43DD60A9e78F2C97Fbbfc7cb1"}],[h.cF.id]:[{symbol:"ETH",address:f,decimals:18,priceFeed:""},{symbol:"ZOLLPTT",address:"0xcB6A2D2185C9c01739C9AD9110424146934cfAe7",decimals:18,priceFeed:""},{symbol:"WETH",address:"0xc4CebF58836707611439e23996f4FA4165Ea6A28",decimals:18,priceFeed:""},{symbol:"USDC",address:"0x2E6D0aA9ca3348870c7cbbC28BF6ea90A3C1fE36",decimals:6,priceFeed:""}]},N=g.HV,k=(e,t)=>e.map(e=>{let a={eventName:t,paymentId:e.args.paymentId,amount:e.args.amount,tokenAddress:e.args.tokenAddress,blockHash:e.blockHash};return"PaymentSent"===t?(a.from=e.args.from,a.to=e.args.to):a.by=e.args.by,a});function w(e){let{address:t,chain:a}=(0,i.F)(),s=(0,c.e)(),{data:g}=(0,o.G)(),{writeContractAsync:h}=(0,m.x)(),[w,C]=(0,r.useState)("0"),[A,S]=(0,r.useState)([]),[F,D]=(0,r.useState)(!1),[E,T]=(0,r.useState)({type:"",message:""}),[P,B]=(0,r.useState)(void 0),I=(null==a?void 0:a.id)?v[a.id]:void 0,{isLoading:R,isSuccess:U}=(0,x.g)({hash:P}),{data:H}=(0,u.Q)({address:(null==e?void 0:e.address)!==f?null==e?void 0:e.address:void 0,abi:p.xw,functionName:"balanceOf",args:t?[t]:void 0,query:{enabled:!!t&&!!e&&e.address!==f}}),M=(0,r.useCallback)(async()=>{if(!t||!s)return BigInt(0);try{return await s.getBalance({address:t})}catch(e){return console.error("Error getting native balance:",e),BigInt(0)}},[t,s]);(0,r.useEffect)(()=>{(async()=>{if((null==e?void 0:e.address)===f){let t=await M();C((0,l.Js)(t,e.decimals||18))}})()},[e,M]),(0,r.useEffect)(()=>{e&&e.address!==f&&H&&C((0,l.Js)(H,e.decimals||18))},[H,e]);let _=(0,r.useCallback)(async()=>{if(t&&s&&e)try{let a;if(e.address===f)a=await s.getBalance({address:t});else{let r=e.address;a=await s.readContract({address:r,abi:p.xw,functionName:"balanceOf",args:[t]})}let r=e.decimals||18,n=(0,l.Js)(a,r);C(n)}catch(t){console.error("Error fetching token balance:",t),n.oR.error("Failed to fetch your ".concat(e.symbol||"token"," balance"))}},[t,s,e]),z=(0,r.useCallback)(async()=>{if(t&&s&&I)try{D(!0);let e=await s.getBlockNumber(),r=BigInt(Math.max(0,Number(e)-5760)),n=(0,y.b)(t),[d,i,c,o]=await Promise.all([s.getContractEvents({address:I,abi:N,eventName:"PaymentSent",fromBlock:r,args:{from:n}}),s.getContractEvents({address:I,abi:N,eventName:"PaymentSent",fromBlock:r,args:{to:n}}),s.getContractEvents({address:I,abi:N,eventName:"PaymentClaimed",fromBlock:r}),s.getContractEvents({address:I,abi:N,eventName:"PaymentReimbursed",fromBlock:r})]),m=k(d,"PaymentSent"),x=k(i,"PaymentSent"),u=k(c,"PaymentClaimed"),b=k(o,"PaymentReimbursed"),g=new Map;for(let e of u){let t=await s.getBlock({blockHash:e.blockHash});g.set(e.paymentId,{status:"CLAIMED",timestamp:new Date(1e3*Number(t.timestamp)).toLocaleString(),by:e.by})}for(let e of b){let t=await s.getBlock({blockHash:e.blockHash});g.set(e.paymentId,{status:"REIMBURSED",timestamp:new Date(1e3*Number(t.timestamp)).toLocaleString(),by:e.by})}let h=await Promise.all([...m,...x].map(async e=>{let t,{paymentId:r,from:n,to:d,amount:i,tokenAddress:c}=e,o=await s.getBlock({blockHash:e.blockHash}),m=g.get(r)||{status:"SENT",timestamp:new Date(1e3*Number(o.timestamp)).toLocaleString()};if(c===f){var x;let e=(null==a?void 0:a.id)?j[a.id]:void 0,s=null==e?void 0:e.find(e=>e.address===f);t={symbol:(null==s?void 0:s.symbol)||(null==a||null==(x=a.nativeCurrency)?void 0:x.symbol)||"ETH",decimals:(null==s?void 0:s.decimals)||18}}else{let e=(null==a?void 0:a.id)?j[a.id]:void 0,r=null==e?void 0:e.find(e=>e.address.toLowerCase()===c.toLowerCase());if(r)t={symbol:r.symbol,decimals:r.decimals};else try{let e=await s.readContract({address:c,abi:p.xw,functionName:"symbol"}),a=await s.readContract({address:c,abi:p.xw,functionName:"decimals"});t={symbol:e,decimals:Number(a)}}catch(e){console.warn("Could not get info for token at ".concat(c)),t={symbol:"UNKNOWN",decimals:18}}}let u=(0,l.Js)(i,t.decimals);return{parsedJson:{payment_id:r,payment_object_id:r,from:n,to:d,amount:u,tokenAddress:c,tokenSymbol:t.symbol,created_at:Number(o.timestamp),statusInfo:m}}}));S(h)}catch(e){console.error("Error fetching payments:",e),n.oR.error("Failed to fetch payment history")}finally{D(!1)}},[t,s,I,a]);(0,r.useEffect)(()=>{t&&s&&(_(),z())},[t,s,e,a,_,z]);let{data:L,refetch:W}=(0,u.Q)({address:(null==e?void 0:e.address)!==f?null==e?void 0:e.address:void 0,abi:p.xw,functionName:"allowance",args:t&&I?[t,I]:void 0,query:{enabled:!!t&&!!I&&!!e&&e.address!==f}}),J=e=>(0,d.S)((0,b.i3)(e)),V=async()=>{if(!s)return!1;try{return await s.getBlockNumber(),!0}catch(e){return console.error("Network health check failed:",e),!1}},q=async()=>{if(s)try{var e,t;if(null==(t=s.chain)||null==(e=t.fees)||!e.baseFeeMultiplier)return{gasPrice:await s.getGasPrice()*BigInt(2)};{let e=await s.estimateFeesPerGas();return{maxFeePerGas:e.maxFeePerGas?e.maxFeePerGas*BigInt(2):void 0,maxPriorityFeePerGas:e.maxPriorityFeePerGas?e.maxPriorityFeePerGas*BigInt(2):void 0}}}catch(e){console.error("Error estimating gas:",e);return}},O=async(s,r,d)=>{if(D(!0),T({type:"",message:""}),!t||!g){T({type:"error",message:"Wallet not connected"}),D(!1);return}if(!s||!r||!d){T({type:"error",message:"Please fill all required fields"}),D(!1);return}let i=parseFloat(d);if(isNaN(i)||i<=0){T({type:"error",message:"Please enter a valid amount greater than zero"}),D(!1);return}if(!I){T({type:"error",message:"Contract not deployed on this network"}),D(!1);return}if(!await V()){T({type:"error",message:"Network connection issues detected. Please try again later."}),D(!1);return}try{var c,o,m;let t="".concat(s,"-").concat(Date.now(),"-").concat(Math.floor(1e7*Math.random()),"-").concat(crypto.randomUUID().slice(0,8)),n=J(t);console.log("Payment ID:",t),console.log("Bytes Payment ID:",n),console.log("Payee Address:",r);let i=e.decimals||18,x=BigInt((0,l.XS)(d,i).toString());console.log("Amount in Wei:",x.toString());let u=e.address===f||"0x0000000000000000000000000000000000001010"===e.address||(null==(c=e.symbol)?void 0:c.toUpperCase())===(null==a||null==(m=a.nativeCurrency)||null==(o=m.symbol)?void 0:o.toUpperCase());if(console.log("Is Native Token:",u),console.log("Selected Token:",e),console.log("Contract Address:",I),u){T({type:"info",message:"Preparing transaction, please confirm in your wallet..."});try{let e=await q();console.log("Sending transaction with params:",{address:I,functionName:"sendETH",args:[n,r],value:x,...e});let t=await h({address:I,abi:N,functionName:"sendETH",args:[n,r],value:x,...e});B(t),T({type:"info",message:"Transaction sent. Waiting for confirmation..."})}catch(e){throw console.error("Inner transaction error:",e),e.shortMessage&&console.error("Error short message:",e.shortMessage),e.cause&&console.error("Error cause:",e.cause),e}}}catch(a){console.error("Transaction failed:",a);let e=a.message||"Unknown error",t=e.match(/reverted with reason string '([^']+)'/);t&&t[1]&&(e=t[1]),T({type:"error",message:"Error: ".concat(e)}),n.oR.error("Transaction failed: ".concat(e)),D(!1)}};(0,r.useEffect)(()=>{U&&P&&(T({type:"success",message:"Transaction successful! Hash: ".concat(P)}),n.oR.success("Transaction completed successfully!"),z(),_(),D(!1),setTimeout(()=>{B(void 0)},5e3))},[U,P,z,_]);let Y=async(e,a)=>{var s,r;if(!e)return void T({type:"error",message:"Please enter a payment ID"});if(!t||!g)return void T({type:"error",message:"Wallet not connected"});let l=A.find(t=>t.parsedJson.payment_id===e||t.parsedJson.payment_object_id===e);if(l&&(null==(s=l.parsedJson.statusInfo)?void 0:s.status)!=="SENT"){T({type:"error",message:"This payment cannot be ".concat(a,"ed because it has status: ").concat(null==(r=l.parsedJson.statusInfo)?void 0:r.status)}),n.oR.error("Payment is not in a ".concat(a,"able state"));return}D(!0),T({type:"info",message:"Preparing transaction..."});try{if(!I)throw Error("Contract address not available");let t=e.startsWith("0x")&&66===e.length?e:J(e);T({type:"info",message:"Initiating ".concat(a,". Please confirm in your wallet...")});let s=await h({address:I,abi:N,functionName:a,args:[t]});B(s),T({type:"info",message:"Transaction sent. Waiting for confirmation..."})}catch(e){console.error("".concat(a," transaction failed:"),e),T({type:"error",message:"Error: ".concat(e.message||"Transaction failed")}),n.oR.error("Transaction failed: ".concat(e.message)),D(!1)}};return{currentAccount:t,coinObjects:[{balance:w}],payments:A,isLoading:F||R,resultMessage:E,setResultMessage:T,sendPayment:O,executePaymentAction:Y,fetchPayments:z,fetchUserCoins:_}}var C=a(18224),A=a(47924),S=a(55868),F=a(25305),D=a(81284),E=a(40646),T=a(54861),P=a(1243),B=a(54416);function I(e){let{message:t,onDismiss:a}=e,[n,l]=(0,r.useState)(!1),[d,i]=(0,r.useState)("");if((0,r.useEffect)(()=>{t.message&&t.message!==d&&(l(!0),i(""))},[t,d]),!t.message||!n)return null;let c={container:"border-gray-200 bg-gray-50 text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200",icon:"text-gray-500 dark:text-gray-400"},o=D.A;switch(t.type){case"success":c.container="border-green-200 bg-green-50 text-green-800 dark:border-green-800/30 dark:bg-green-900/20 dark:text-green-400",c.icon="text-green-500 dark:text-green-400",o=E.A;break;case"error":c.container="border-red-200 bg-red-50 text-red-800 dark:border-red-800/30 dark:bg-red-900/20 dark:text-red-400",c.icon="text-red-500 dark:text-red-400",o=T.A;break;case"info":c.container="border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-800/30 dark:bg-blue-900/20 dark:text-blue-400",c.icon="text-blue-500 dark:text-blue-400",o=D.A;break;case"warning":c.container="border-yellow-200 bg-yellow-50 text-yellow-800 dark:border-yellow-800/30 dark:bg-yellow-900/20 dark:text-yellow-400",c.icon="text-yellow-500 dark:text-yellow-400",o=P.A}return(0,s.jsxs)("div",{className:"\n                flex items-start justify-between px-4 py-3 mb-4 rounded-lg border \n                shadow-sm transition-all duration-300 ease-in-out\n                ".concat(c.container," \n                ").concat(n?"opacity-100 transform translate-y-0":"opacity-0 transform -translate-y-2","\n            "),role:"alert",children:[(0,s.jsxs)("div",{className:"flex items-start flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mr-3 ".concat(c.icon),children:(0,s.jsx)(o,{size:18})}),(0,s.jsx)("div",{className:"flex-1 text-sm font-medium break-words overflow-auto max-h-24",children:t.message})]}),a&&(0,s.jsx)("button",{onClick:()=>{l(!1),i(t.message),a&&a()},className:"ml-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 flex-shrink-0",children:(0,s.jsx)(B.A,{size:16})})]})}var R=a(14038),U=a(28707);function H(e){let{selectedToken:t,isLoading:a,resultMessage:n,onSendPayment:l,onDismissResult:d}=e,[o,m]=(0,r.useState)(""),[x,u]=(0,r.useState)(""),[y,b]=(0,r.useState)(0),[p,g]=(0,r.useState)(!1),[h,f]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[w,D]=(0,r.useState)(!1),{address:E}=(0,i.F)(),T=(0,C.i)(),P=(0,c.e)(),[B,H]=(0,r.useState)([]),[M,_]=(0,r.useState)(!1),[z,L]=(0,r.useState)(""),[W,J]=(0,r.useState)(!1);(0,r.useEffect)(()=>{j("payment-".concat(Date.now(),"-").concat(Math.floor(1e6*Math.random())))},[]),(0,r.useEffect)(()=>{E&&V()},[E]),(0,r.useEffect)(()=>{D(a)},[a]),(0,r.useEffect)(()=>{(async()=>{if(t&&T)try{let e;g(!0),e=P&&"transport"in P&&"url"in P.transport?new U.FR(P.transport.url):new U.FR;let a=await (0,R.E)(e,t.symbol,T);b(a)}catch(e){console.error("Failed to fetch ".concat(null==t?void 0:t.symbol," exchange rate:"),e),k("Could not fetch current ".concat(null==t?void 0:t.symbol," price. Using fallback rate.")),(null==t?void 0:t.symbol.includes("USD"))?b(1):b(.001)}finally{g(!1)}})()},[t,T,P]),(0,r.useEffect)(()=>{(async()=>{if(!x||!t||isNaN(parseFloat(x))||0>=parseFloat(x))return m("");g(!0);try{let e=y>0?y:t.symbol.includes("USD")?1:.001,a=parseFloat(x);m((a*e).toFixed(6))}catch(e){console.error("Error converting USD to ".concat(t.symbol,":"),e),k("Could not convert USD to ".concat(t.symbol,". Please try again."))}finally{g(!1)}})()},[x,y,t]);let V=async()=>{try{let e=await (0,F.QC)();H(e.data)}catch(e){console.error("Failed to load address book:",e)}},q=async e=>{if(L(e),e.length>0){J(!0);try{let t=await (0,F.vC)(e);H(t.data)}catch(e){console.error("Address search failed:",e)}finally{J(!1)}}else V()},O=e=>{f(e.walletAddress),_(!1)},Y=async()=>{if(!h||!o)return void k("Please provide both recipient and amount");if(!h.startsWith("0x")||42!==h.length)try{let e=await (0,F.S1)(h);if(!e.startsWith("0x")||42!==e.length)return void k("Invalid Ethereum address format");f(e)}catch(e){k("Could not resolve nickname: ".concat(h));return}k(""),D(!0);try{l(v,h,o)}catch(e){k("Payment failed: "+(e instanceof Error?e.message:String(e))),D(!1)}},G=a||w;return(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsxs)("div",{className:"max-w-4xl w-full space-y-6 backdrop-blur-sm p-8 rounded-lg",children:[(0,s.jsx)(I,{message:N?{type:"error",message:N}:n||{type:"",message:""},onDismiss:()=>{k(""),d&&d()}}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recipient Address or Username"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:h,onChange:e=>{let t=e.target.value;f(t),t.length>2?(_(!0),q(t)):0===t.length&&_(!1)},onKeyPress:e=>{"Enter"===e.key&&(_(!0),q(h))},className:"w-full p-2 pr-10 bg-transparent border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white",placeholder:"0x... or username",disabled:G}),(0,s.jsx)("button",{type:"button",onClick:()=>{_(!M),M||V()},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",disabled:G,children:(0,s.jsx)(A.A,{size:18})}),M&&(0,s.jsx)("div",{className:"absolute z-10 w-full mt-1 backdrop-blur-md bg-white/70 dark:bg-gray-800/70 rounded-md shadow-lg",children:(0,s.jsx)("div",{className:"max-h-48 overflow-y-auto",children:W?(0,s.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:"Searching..."}):B.length>0?B.map(e=>(0,s.jsxs)("div",{className:"p-3 hover:bg-gray-100/80 dark:hover:bg-gray-700/80 cursor-pointer border-b border-gray-200/50 dark:border-gray-700/50",onClick:()=>O(e),children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.nickname}),(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.walletAddress})]},e._id)):(0,s.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:z?"No contacts found":"Your address book is empty"})})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Amount (USD)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-2",children:(0,s.jsx)(S.A,{size:16,className:"text-gray-500 dark:text-gray-400"})}),(0,s.jsx)("input",{type:"text",value:x,onChange:e=>{let t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&u(t)},className:"w-full p-2 pl-8 bg-transparent border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white",placeholder:"0.00",disabled:G})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Equivalent in ",(null==t?void 0:t.symbol)||"Token"]}),(0,s.jsx)("div",{className:"relative",children:p?(0,s.jsx)("div",{className:"w-full p-2 bg-transparent border-b border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",children:"Converting..."}):(0,s.jsx)("div",{className:"w-full p-2 bg-transparent border-b border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",children:o?"".concat(o," ").concat((null==t?void 0:t.symbol)||"Token"):"0.00 ".concat((null==t?void 0:t.symbol)||"Token")})}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Exchange Rate: 1 USD ≈ ",y>0?y.toFixed(6):"..."," ",(null==t?void 0:t.symbol)||"Token"]})]})]}),(0,s.jsx)("button",{type:"button",onClick:Y,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 hover:from-blue-700 hover:to-blue-800 text-white py-3 rounded-md font-medium shadow-md transition-all duration-300 disabled:opacity-70 disabled:cursor-not-allowed",disabled:G||p||!o||!h,children:G&&w?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending Payment..."]}):p?"Preparing...":"Send ".concat(o?o+" "+((null==t?void 0:t.symbol)||"Token"):"Payment")})]})})}function M(){return(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Important:"})," Only payments with 'Sent' status can be claimed or reimbursed."]}),(0,s.jsxs)("ul",{className:"list-disc pl-5 text-sm",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-blue-600",children:"Sent"})," - Payment is waiting to be claimed by recipient or reimbursed by sender"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-green-600",children:"Claimed"})," - Payment has already been claimed by the recipient"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-yellow-600",children:"Reimbursed"})," - Payment has been returned to the sender"]})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs",children:[(0,s.jsx)("span",{className:"font-medium",children:"Note:"})," If a payment has already been claimed, it cannot be reimbursed. If it has been reimbursed, it cannot be claimed."]})]})}function _(e){let{onClick:t,isDisabled:a,actionType:r,buttonType:n,isLoading:l,title:d,label:i,activeColor:c}=e,o={"dark:bg-green-500 bg-green-300":{base:"bg-green-300 dark:bg-green-500",hover:"hover:bg-green-400 dark:hover:bg-green-600",active:"active:bg-green-500 dark:active:bg-green-700",shadow:"shadow-green-200/50 dark:shadow-green-900/20"},"dark:bg-yellow-500 bg-yellow-300":{base:"bg-yellow-300 dark:bg-yellow-500",hover:"hover:bg-yellow-400 dark:hover:bg-yellow-600",active:"active:bg-yellow-500 dark:active:bg-yellow-700",shadow:"shadow-yellow-200/50 dark:shadow-yellow-900/20"}}[c]||{base:"bg-gray-300 dark:bg-gray-600",hover:"hover:bg-gray-400 dark:hover:bg-gray-700",active:"active:bg-gray-500 dark:active:bg-gray-800",shadow:"shadow-gray-200/50 dark:shadow-gray-900/20"};return(0,s.jsxs)("button",{onClick:t,disabled:a,className:"\n                flex-1 relative py-3 px-6 rounded-lg font-medium text-sm\n                transition-all duration-200 ease-in-out\n                transform hover:scale-[1.02] active:scale-[0.98]\n                focus:outline-none focus:ring-2 focus:ring-opacity-50\n                \n                ".concat(r===n?"\n                    ".concat(o.base,"\n                    shadow-lg ").concat(o.shadow,"\n                    ").concat(o.hover,"\n                    ").concat(o.active,"\n                    focus:ring-opacity-50 focus:ring-green-400 dark:focus:ring-green-700\n                "):"\n                    bg-gray-200 dark:bg-gray-700\n                    hover:bg-gray-300 dark:hover:bg-gray-600\n                    shadow-md shadow-gray-200/30 dark:shadow-gray-900/10\n                    active:bg-gray-400 dark:active:bg-gray-800\n                    focus:ring-gray-400 dark:focus:ring-gray-500\n                ","\n                \n                disabled:opacity-60 disabled:cursor-not-allowed\n                disabled:shadow-none disabled:transform-none\n                disabled:bg-gray-200 dark:disabled:bg-gray-800\n                disabled:hover:scale-100\n                \n                text-gray-800 dark:text-white\n            "),title:d,children:[l?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{children:"Processing..."})]}):(0,s.jsx)("span",{children:i}),!a&&(0,s.jsx)("span",{className:"absolute inset-0 rounded-lg opacity-20 bg-gradient-to-t from-black/5 to-white/20 pointer-events-none"})]})}function z(e){var t,a,n,l;let{isLoading:d,payments:c,onExecutePaymentAction:o,preselectedPaymentId:m="",preselectedAction:x,onClearAction:u}=e,{address:y}=(0,i.F)(),[b,p]=(0,r.useState)(m),[g,h]=(0,r.useState)(x),[f,v]=(0,r.useState)({type:"",message:""});(0,r.useEffect)(()=>{p(m),h(x)},[m,x]);let j=e=>{o(b,e),h(e)},N=c.find(e=>e.parsedJson.payment_object_id===b);return(0,s.jsxs)("div",{children:[(0,s.jsx)(I,{message:f,onDismiss:()=>{v({type:"",message:""})}}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-900 dark:text-white",children:"Payment ID"}),(0,s.jsx)("input",{type:"text",value:b,onChange:e=>{p(e.target.value),h(null),e.target.value!==m&&u()},placeholder:"0x...",className:"bg-transparent w-full p-2 border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the payment ID you want to claim or reimburse"})]}),b&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-800/30 rounded-md",children:[(0,s.jsx)("h4",{className:"font-medium text-sm mb-2 text-gray-900 dark:text-white",children:"Payment Status Check"}),(0,s.jsx)(M,{}),N&&(0,s.jsxs)("div",{className:"mt-3 p-2 bg-white dark:bg-gray-800/50 border-b border-gray-300 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[(0,s.jsx)("strong",{children:"Payment ID:"})," ",N.parsedJson.payment_id]}),(0,s.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[(0,s.jsx)("strong",{children:"Amount:"})," ",N.parsedJson.amount," ",N.parsedJson.tokenSymbol]})]})]}),(0,s.jsx)("div",{className:"flex flex-row items-center justify-center",children:(0,s.jsxs)("div",{className:"w-auto space-x-3",children:[(0,s.jsx)(_,{onClick:()=>j("claim"),isDisabled:d||"reimburse"===g||!N||(null==(t=N.parsedJson.statusInfo)?void 0:t.status)!=="SENT"||(null==(a=N.parsedJson.from)?void 0:a.toLowerCase())===(null==y?void 0:y.toLowerCase()),actionType:g,buttonType:"claim",isLoading:d,title:"Claim this payment to your wallet",label:"Claim Payment",activeColor:"dark:bg-green-500 bg-green-300"}),(0,s.jsx)(_,{onClick:()=>j("reimburse"),isDisabled:d||"claim"===g||!N||(null==(n=N.parsedJson.statusInfo)?void 0:n.status)!=="SENT"||(null==(l=N.parsedJson.from)?void 0:l.toLowerCase())!==(null==y?void 0:y.toLowerCase()),actionType:g,buttonType:"reimburse",isLoading:d,title:"Return this payment to your wallet",label:"Reimburse Payment",activeColor:"dark:bg-yellow-500 bg-yellow-300"})]})})]})}function L(e){let{status:t}=e,a="bg-blue-100 text-blue-800",r="Pending";return"CLAIMED"===t?(a="bg-green-100 text-green-800",r="Claimed"):"REIMBURSED"===t&&(a="bg-yellow-100 text-yellow-800",r="Reimbursed"),(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(a),children:r})}function W(e){var t,a,r,n,l,d;let{payment:i,currentUserAddress:c,selectedToken:o,onActionSelected:m}=e,x=i.parsedJson,u=(null==(t=x.from)?void 0:t.toLowerCase())===(null==c?void 0:c.toLowerCase()),y=(null==(a=x.to)?void 0:a.toLowerCase())===(null==c?void 0:c.toLowerCase()),b=(null==(r=x.statusInfo)?void 0:r.status)||"SENT",p=y&&"SENT"===b,g=u&&"SENT"===b,h="string"==typeof x.payment_id?x.payment_id:String(x.payment_id);return(0,s.jsxs)("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900/10",children:[(0,s.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:h}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(u?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"),children:u?"Sent":"Received"})}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:u?"To: ".concat(null==(n=x.to)?void 0:n.substring(0,8),"..."):"From: ".concat(null==(l=x.from)?void 0:l.substring(0,8),"...")}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:[x.amount," ",x.tokenSymbol||(null==o?void 0:o.symbol)||"ETH"]}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm",children:[(0,s.jsx)(L,{status:b}),(null==(d=x.statusInfo)?void 0:d.timestamp)&&(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:x.statusInfo.timestamp})]}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[p&&(0,s.jsx)("button",{onClick:()=>m(x.payment_object_id,"claim"),className:"px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600",title:"Claim this payment to your wallet",children:"Claim"}),g&&(0,s.jsx)("button",{onClick:()=>m(x.payment_object_id,"reimburse"),className:"px-3 py-1 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600",title:"Return this payment to your wallet",children:"Reimburse"}),!p&&!g&&(0,s.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"CLAIMED"===b?"Payment claimed":"Payment reimbursed"})]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["ID: ",x.payment_object_id.substring(0,8),"..."]})]})]})}function J(e){let{payments:t,selectedToken:a,onActionSelected:r}=e,{address:n}=(0,i.F)();return n?(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-3 text-gray-900 dark:text-white",children:"Payment History"}),0===t.length?(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No payments found."}):(0,s.jsx)("div",{className:"overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Payment ID"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Direction"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Address"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Amount"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>(0,s.jsx)(W,{payment:e,currentUserAddress:n,selectedToken:a,onActionSelected:r},t))})]})})]}):(0,s.jsx)("div",{className:"text-gray-900 dark:text-white",children:"Please connect your wallet to view payment history."})}var V=a(49103),q=a(75525),O=a(28883),Y=a(13717),G=a(62525);function K(e){let{initialData:t=null,onSubmit:a,onCancel:n,validateAddress:l}=e,[d,i]=(0,r.useState)(""),[c,o]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[u,y]=(0,r.useState)({});(0,r.useEffect)(()=>{t&&(i(t.nickname),o(t.walletAddress),x(t.email||""))},[t]);let b=()=>{let e={};return d.trim()||(e.nickname="Nickname is required"),c.trim()||(e.walletAddress="Wallet address is required"),m&&!m.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(e.email="Please enter a valid email address"),c&&!l(c)&&(e.walletAddress="Invalid wallet address format"),y(e),0===Object.keys(e).length};return(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b()&&(a({nickname:d,walletAddress:c,email:m}),t||(i(""),o(""),x("")))},className:"border-b border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-transparent backdrop-blur-md",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"nickname",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nickname"}),(0,s.jsx)("input",{id:"nickname",type:"text",value:d,onChange:e=>i(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(u.nickname?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter a nickname"}),u.nickname&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:u.nickname})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"EVM Wallet Address"}),(0,s.jsx)("input",{id:"walletAddress",type:"text",value:c,onChange:e=>o(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(u.walletAddress?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0x..."}),u.walletAddress&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:u.walletAddress})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Address"}),(0,s.jsx)("input",{id:"email",type:"email",value:m,onChange:e=>x(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(u.email?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"example@domain.com"}),u.email&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:u.email})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 border-b border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100/20 dark:hover:bg-gray-700/20",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 hover:from-blue-700 hover:to-blue-800 text-white rounded-md shadow-sm",children:t?"Update":"Save"})]})]})}var Q=a(81757);function Z(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[d,c]=(0,r.useState)(""),[o,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(null),{address:y,isConnected:b}=(0,i.F)();(0,r.useEffect)(()=>{y&&b&&p()},[y,b]);let p=async()=>{l(!0);try{let e=await (0,F.QC)();t(e.data)}catch(e){console.error("Failed to fetch addresses:",e),n.oR.error("Failed to load address book")}finally{l(!1)}},g=e=>(0,Q.P)(e),h=async e=>{let a=e.target.value;if(c(a),a.length>0){l(!0);try{let e=await (0,F.vC)(a);t(e.data)}catch(e){console.error("Search failed:",e),n.oR.error("Search failed. Please try again.")}finally{l(!1)}}else p()},f=async e=>{try{let t=e.walletAddress.toLowerCase().startsWith("0x")?e.walletAddress:"0x".concat(e.walletAddress);await (0,F.E1)(e.nickname,t,e.email),m(!1),n.oR.success("Contact added successfully"),p()}catch(e){var t,a;console.error("Failed to add address:",e),n.oR.error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Failed to add contact")}},v=async e=>{try{if(!x)return;let t=e.walletAddress.toLowerCase().startsWith("0x")?e.walletAddress:"0x".concat(e.walletAddress),a={...t!==x.walletAddress?{walletAddress:t}:{},...e.nickname!==x.nickname?{newNickname:e.nickname}:{},...e.email!==x.email?{email:e.email}:{}};await (0,F.yU)(x.nickname,a),u(null),n.oR.success("Contact updated successfully"),p()}catch(e){var t,a;console.error("Failed to update address:",e),n.oR.error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Failed to update contact")}},[j,N]=(0,r.useState)(!1),[k,w]=(0,r.useState)(""),C=e=>{w(e),N(!0)},S=async()=>{try{await (0,F.ab)(k),n.oR.success("Contact deleted successfully"),p()}catch(e){console.error("Failed to delete address:",e),n.oR.error("Failed to delete contact")}finally{N(!1)}},D=e=>e?e.length<10?e:"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"";return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Address Book"}),(0,s.jsxs)("button",{onClick:()=>m(!o),className:"flex items-center gap-1 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white px-3 py-2 rounded-md",children:[(0,s.jsx)(V.A,{size:16}),(0,s.jsx)("span",{children:"Add Contact"})]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",size:18}),(0,s.jsx)("input",{type:"text",placeholder:"Search contacts...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-transparent text-gray-900 dark:text-white",value:d,onChange:h})]}),o&&(0,s.jsx)(K,{onSubmit:f,onCancel:()=>m(!1),validateAddress:g}),x&&(0,s.jsx)(K,{initialData:x,onSubmit:v,onCancel:()=>u(null),validateAddress:g}),(0,s.jsx)("div",{className:"mt-4",children:a?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):e.length>0?(0,s.jsx)("div",{className:"grid gap-2",children:e.map(e=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3 border border-gray-200 dark:border-gray-700 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:e.nickname}),e.isVerifiedUser&&(0,s.jsx)(q.A,{size:16,className:"ml-2 text-green-500"})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[D(e.walletAddress),(0,s.jsx)("button",{className:"ml-2 text-blue-500 hover:text-blue-600 text-xs",onClick:()=>{navigator.clipboard.writeText(e.walletAddress),n.oR.success("Address copied to clipboard")},children:"Copy"})]}),e.email&&(0,s.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,s.jsx)(O.A,{size:12,className:"mr-1"}),(0,s.jsx)("span",{children:e.email})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>u(e),className:"p-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",children:(0,s.jsx)(Y.A,{size:18})}),(0,s.jsx)("button",{onClick:()=>C(e.nickname),className:"p-1 text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400",children:(0,s.jsx)(G.A,{size:18})})]})]},e._id))}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:d?"No contacts found":"Your address book is empty"})}),j&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Confirm Deletion"}),(0,s.jsxs)("p",{className:"mb-6",children:["Are you sure you want to delete ",k,"?"]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:()=>N(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),(0,s.jsx)("button",{onClick:S,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})})]})}function X(e){let{selectedToken:t}=e,[a,n]=(0,r.useState)("send"),[l,d]=(0,r.useState)(""),[i,c]=(0,r.useState)(null),{payments:o,isLoading:m,resultMessage:x,setResultMessage:u,sendPayment:y,executePaymentAction:b}=w(t),p=()=>{d(""),c(null)};return(0,s.jsxs)("div",{className:"mt-8 min-w-[70vw] bg-transparent rounded-xl overflow-hidden",children:[(0,s.jsx)("div",{className:"flex border-b border-gray-200 dark:border-gray-800 mb-4",children:[{id:"send",label:"Send Payment"},{id:"claim",label:"Claim/Reimburse"},{id:"history",label:"Payment History"},{id:"addressBook",label:"Address Book"}].map(e=>(0,s.jsx)("button",{onClick:()=>{n(e.id),p()},className:"px-4 py-3 text-sm font-medium ".concat(a===e.id?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"),children:e.label},e.id))}),(0,s.jsxs)("div",{className:"p-4",children:["send"===a&&(0,s.jsx)(H,{selectedToken:t,isLoading:m,resultMessage:x,onSendPayment:y,onDismissResult:()=>{u({type:"",message:""})}}),"claim"===a&&(0,s.jsx)(z,{isLoading:m,payments:o,onExecutePaymentAction:b,preselectedPaymentId:l,preselectedAction:i,onClearAction:p}),"history"===a&&(0,s.jsx)(J,{payments:o,selectedToken:t,onActionSelected:(e,t)=>{d(e),c(t),n("claim")}}),"addressBook"===a&&(0,s.jsx)(Z,{})]})]})}var $=a(35196),ee=a(74228);let et=async(e,t,a)=>(await ee.A.post("/split-bill",{invoiceId:e,initiatorWalletAddress:t,participants:a})).data,ea=async()=>(await ee.A.get("/split-bill/initiated")).data,es=async()=>(await ee.A.get("/split-bill/participating")).data,er=async(e,t,a)=>(await ee.A.patch("/split-bill/".concat(e,"/participant/").concat(t),{transactionHash:a})).data;var en=a(14186),el=a(17580);let ed=e=>{let{selectedToken:t,refreshTrigger:a=0}=e,[l,d]=(0,r.useState)([]),[o,m]=(0,r.useState)([]),[x,u]=(0,r.useState)("initiated"),[y,b]=(0,r.useState)(!0),[p,g]=(0,r.useState)(null),[h,f]=(0,r.useState)(null),[v,j]=(0,r.useState)(!1),[N,k]=(0,r.useState)(0),{address:C}=(0,i.F)(),{user:A}=(0,$.A)(),F=(0,c.e)(),{sendPayment:D,isLoading:T,resultMessage:P,setResultMessage:H}=w(t);(0,r.useEffect)(()=>{(async()=>{if(A){b(!0);try{let e=await ea();d(e.data);let t=await es();m(t.data)}catch(e){console.error("Failed to fetch split bills:",e),n.oR.error("Failed to load your split bills")}finally{b(!1)}}})()},[a,A]),(0,r.useEffect)(()=>{(async()=>{if(t&&F)try{var e;let a,s=(null==(e=F.chain)?void 0:e.id)||1;a="transport"in F&&"url"in F.transport?new U.FR(F.transport.url):new U.FR;let r=await (0,R.E)(a,t.symbol,s);k(r),console.log("Exchange rate loaded: 1 USD = ".concat(r," ").concat(t.symbol))}catch(e){console.error("Failed to fetch ".concat(t.symbol," exchange rate:"),e),t.symbol.includes("USD")?k(1):k(.001)}})()},[t,F]);let M=e=>C&&(null==A?void 0:A.email)?e.participants.find(e=>e.email===A.email||e.walletAddress===C):null,_=e=>{g(e)},z=e=>{f(e),j(!0)},L=e=>e*N,W=e=>e>=.01?e.toFixed(4):e.toFixed(8),J=async()=>{if(!h||!C||!A)return;let e=M(h);if(!e)return void n.oR.error("Could not find your payment details");if("paid"===e.status){(0,n.oR)("You have already paid your share"),j(!1);return}let a="SPLIT-PAY-".concat(Date.now(),"-").concat(Math.floor(1e6*Math.random()));H({type:"",message:""});try{let s;s=L(e.amount).toFixed(8),console.log("Payment amount: ".concat(e.amount," USD → ").concat(s," ").concat((null==t?void 0:t.symbol)||"ETH")),await D(a,h.initiatorWalletAddress,s)}catch(e){console.error("Payment failed:",e),n.oR.error("Failed to make payment")}};(0,r.useEffect)(()=>{if(h&&"success"===P.type&&P.message.includes("Hash:")&&(null==A?void 0:A.email)){let e=P.message.split("Hash: ")[1];(async()=>{try{await er(h.splitId,A.email,e);let t=await es();m(t.data),n.oR.success("Your payment has been recorded"),setTimeout(()=>{j(!1),f(null)},2e3)}catch(e){console.error("Failed to update payment status:",e),n.oR.error("Payment was sent but failed to update status")}})()}},[P,h,null==A?void 0:A.email]);let V=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),q=e=>{switch(e.status){case"active":return(0,s.jsx)(en.A,{className:"h-5 w-5 text-yellow-500"});case"completed":return(0,s.jsx)(E.A,{className:"h-5 w-5 text-green-500"});case"cancelled":return(0,s.jsx)(B.A,{className:"h-5 w-5 text-red-500"});default:return null}};if(!A)return(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"Please sign in to view your split bills"});if(y)return(0,s.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})});let O="initiated"===x?l:o;return null==t||t.symbol,(0,s.jsxs)("div",{className:"mt-4 w-full",children:[(0,s.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[(0,s.jsx)("button",{className:"px-4 py-2 font-medium text-sm ".concat("initiated"===x?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>u("initiated"),children:"Splits You Created"}),(0,s.jsx)("button",{className:"px-4 py-2 font-medium text-sm ".concat("participating"===x?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>u("participating"),children:"Splits to Pay"})]}),0===O.length?(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"No split bills found"}):(0,s.jsx)("div",{className:"space-y-4",children:O.map(e=>(0,s.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("h3",{className:"font-medium text-lg",children:["Split ",e.splitId]}),(0,s.jsx)("div",{className:"ml-2",children:q(e)})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["For invoice ",e.invoiceNumber]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Total: "}),(0,s.jsxs)("span",{className:"font-medium",children:[e.totalAmount," USD"]})]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Due: "}),(0,s.jsx)("span",{className:"font-medium",children:V(e.dueDate)})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("button",{onClick:()=>_(e),className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"View Details"}),"participating"===x&&(()=>{let t=M(e);return t?"paid"===t.status?(0,s.jsxs)("span",{className:"text-sm text-green-600 dark:text-green-500 flex items-center",children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-1"}),"Paid"]}):"active"===e.status?(0,s.jsxs)("button",{onClick:()=>z(e),className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:["Pay ",t.amount," USD"]}):null:null})()]})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,s.jsx)(el.A,{className:"h-4 w-4 mr-1"}),(0,s.jsxs)("span",{children:[e.participants.filter(e=>"paid"===e.status).length," of ",e.participants.length," paid"]})]})})]},e._id))}),p&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-2xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold",children:"Split Details"}),(0,s.jsx)("button",{onClick:()=>g(null),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(B.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Split ID"}),(0,s.jsx)("p",{className:"font-medium",children:p.splitId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Invoice"}),(0,s.jsx)("p",{className:"font-medium",children:p.invoiceNumber})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Amount"}),(0,s.jsxs)("p",{className:"font-medium",children:[p.totalAmount," USD"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:V(p.dueDate)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),(0,s.jsxs)("div",{className:"flex items-center",children:[q(p),(0,s.jsx)("span",{className:"ml-2 capitalize",children:p.status})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Created"}),(0,s.jsx)("p",{className:"font-medium",children:V(p.createdAt)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Participants"}),(0,s.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700 border border-gray-200 dark:border-gray-700 rounded-md",children:p.participants.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.nickname}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-medium",children:[e.amount," USD"]}),(0,s.jsx)("p",{className:"text-sm ".concat("paid"===e.status?"text-green-600 dark:text-green-500":"text-yellow-600 dark:text-yellow-500"),children:"paid"===e.status?(0,s.jsxs)("span",{className:"flex items-center justify-end",children:[(0,s.jsx)(E.A,{className:"h-3 w-3 mr-1"}),"Paid on ",V(e.paymentDate||"")]}):(0,s.jsx)("span",{children:"Pending"})})]})]},t))})]}),"completed"===p.status&&p.completedDate&&(0,s.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 rounded-md p-3",children:(0,s.jsxs)("p",{className:"text-green-700 dark:text-green-400 flex items-center",children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"All participants have paid. Split completed on ",V(p.completedDate)]})})]}),(0,s.jsx)("div",{className:"mt-6 flex justify-end",children:(0,s.jsx)("button",{onClick:()=>g(null),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Close"})})]})}),v&&h&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold",children:"Pay Your Share"}),!T&&(0,s.jsx)("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(B.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-md",children:[(0,s.jsxs)("p",{className:"font-medium",children:["Split ID: ",h.splitId]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:["Invoice: ",h.invoiceNumber]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:["Due: ",V(h.dueDate)]})]}),(()=>{let e=M(h);if(!e)return null;let a=L(e.amount);return(0,s.jsxs)("div",{className:"p-4 border border-blue-100 dark:border-blue-900 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("span",{className:"font-medium flex items-center",children:[(0,s.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"USD Amount:"]}),(0,s.jsxs)("span",{className:"font-bold",children:[e.amount," USD"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("span",{className:"font-medium",children:"Token Equivalent:"}),(0,s.jsxs)("span",{className:"font-bold",children:[W(a)," ",(null==t?void 0:t.symbol)||"ETH"]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Exchange Rate: 1 USD = ",N.toFixed(6)," ",(null==t?void 0:t.symbol)||"ETH"]}),(0,s.jsxs)("p",{className:"text-sm mt-3",children:["Paying to: ",h.initiatorWalletAddress.substring(0,8),"..."]})]})})(),T&&(0,s.jsx)(I,{message:{type:"info",message:"Processing your payment..."}}),P.type&&(0,s.jsx)(I,{message:P,onDismiss:()=>H({type:"",message:""})})]}),(0,s.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,s.jsx)("button",{onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:T,children:"Cancel"}),(0,s.jsx)("button",{onClick:J,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",disabled:T||"success"===P.type,children:T?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Processing..."]}):"Confirm Payment"})]})]})})]})},ei=async e=>(await ee.A.get("/invoices/client-invoices?email=".concat(encodeURIComponent(e)))).data,ec=async e=>(await ee.A.post("/invoices",e)).data,eo=async(e,t,a)=>(await ee.A.patch("/invoices/".concat(e,"/payment"),{paymentStatus:t,transactionHash:a})).data;var em=a(94631),ex=a(85339),eu=a(84616),ey=a(87712);let eb=e=>{let{invoice:t,onClose:a,onSuccess:l,tokenSymbol:d="ETH"}=e,[o,m]=(0,r.useState)([]),[x,u]=(0,r.useState)(!0),[y,b]=(0,r.useState)([]),[p,g]=(0,r.useState)(0),[h,f]=(0,r.useState)(0),[v,j]=(0,r.useState)(0),[N,k]=(0,r.useState)(""),[w,C]=(0,r.useState)(!1),{address:A}=(0,i.F)(),S=(0,c.e)(),D=A||"";(0,r.useEffect)(()=>{(async()=>{if(S)try{var e;let a,s=(null==(e=S.chain)?void 0:e.id)||1;a="transport"in S&&"url"in S.transport?new U.FR(S.transport.url):new U.FR;let r=await (0,R.E)(a,d,s);g(r),console.log("Exchange rate loaded: 1 USD = ".concat(r," ").concat(d)),f(t.amount*r)}catch(e){console.error("Failed to fetch ".concat(d," exchange rate:"),e),d.includes("USD")?(g(1),f(t.amount)):(g(.001),f(.001*t.amount))}})()},[S,d,t.amount]),(0,r.useEffect)(()=>{j(t.amount)},[t.amount]),(0,r.useEffect)(()=>{(async()=>{u(!0);try{let e=await (0,F.QC)();m(e.data)}catch(e){console.error("Failed to load contacts:",e),n.oR.error("Failed to load your contacts"),k("Could not load your contacts. Please try again.")}finally{u(!1)}})()},[]),(0,r.useEffect)(()=>{let e=y.reduce((e,t)=>e+t.amount,0);j(parseFloat((t.amount-e).toFixed(2)))},[y,t.amount]);let E=e=>{b(y.filter((t,a)=>a!==e))},T=(e,t)=>{let a=[...y];a[e].amount=t,a[e].tokenAmount=parseFloat((t*p).toFixed(8)),b(a)},P=(e,t)=>{let a=[...y];a[e].nickname=t,b(a)},H=async()=>{if(0===y.length)return void k("Add at least one friend to split the bill with.");if(v<0)return void k("The total split amount exceeds the invoice amount.");if(!D)return void k("Your wallet address is required to create a split.");C(!0),k("");try{let e=y.map(e=>({nickname:e.nickname,amount:e.amount}));await et(t._id,D,e),n.oR.success("Split bill created successfully!"),l(),a()}catch(t){var e,s;console.error("Failed to create split bill:",t),k((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"Failed to create split bill. Please try again."),n.oR.error("Failed to create split bill")}finally{C(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-2xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold",children:["Split Invoice ",t.invoiceNumber]}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",disabled:w,children:(0,s.jsx)(B.A,{size:20})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Invoice Amount (USD)"}),(0,s.jsxs)("p",{className:"font-medium text-lg",children:[t.amount," USD"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(t.dueDate).toLocaleDateString()})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md mb-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Exchange Rate:"}),(0,s.jsxs)("span",{className:"font-medium",children:["1 USD = ",p>0?p.toFixed(6):"..."," ",d]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total in ",d,":"]}),(0,s.jsxs)("span",{className:"font-bold text-lg",children:[(e=>e>=.01?e.toFixed(4):e.toFixed(8))(h)," ",d]})]})]}),N&&(0,s.jsx)(I,{message:{type:"error",message:N},onDismiss:()=>k("")}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(el.A,{className:"h-5 w-5 mr-2"}),(0,s.jsx)("h4",{className:"font-medium",children:"Friends to Split With"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{type:"button",onClick:()=>{if(0===y.length)return void k("Add friends first to split evenly.");let e=y.length+1,a=parseFloat((t.amount/e).toFixed(2)),s=parseFloat((a*p).toFixed(8));b(y.map(e=>({...e,amount:a,tokenAmount:s})))},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline mr-4",disabled:0===y.length||w,children:"Split Evenly"}),(0,s.jsxs)("button",{type:"button",onClick:()=>{if(0===o.length)return void k("No contacts available in your address book.");let e=o.filter(e=>!y.some(t=>t.nickname===e.nickname));if(0===e.length)return void k("All your contacts have been added already.");let t=parseFloat((.5*v).toFixed(2)),a=parseFloat((t*p).toFixed(8));b([...y,{nickname:e[0].nickname,amount:t,tokenAmount:a}])},className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded text-sm",disabled:x||w,children:[(0,s.jsx)(eu.A,{size:14,className:"inline mr-1"}),"Add Friend"]})]})]}),x?(0,s.jsx)("div",{className:"text-center py-4",children:"Loading contacts..."}):(0,s.jsxs)("div",{children:[0===y.length?(0,s.jsx)("div",{className:"text-center py-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-md",children:'Click "Add Friend" to start splitting'}):(0,s.jsx)("div",{className:"space-y-3",children:y.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("select",{value:e.nickname,onChange:e=>P(a,e.target.value),className:"w-full bg-transparent border-b border-gray-300 dark:border-gray-600 py-1 focus:outline-none",disabled:w,children:o.map(e=>(0,s.jsx)("option",{value:e.nickname,disabled:y.some((t,s)=>s!==a&&t.nickname===e.nickname),children:e.nickname},e._id))})}),(0,s.jsxs)("div",{className:"flex flex-col items-end",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",value:e.amount,onChange:e=>T(a,parseFloat(e.target.value)||0),step:"0.01",min:"0.01",max:t.amount.toString(),className:"w-20 bg-transparent border-b border-gray-300 dark:border-gray-600 py-1 text-right focus:outline-none",disabled:w}),(0,s.jsx)("span",{className:"ml-1",children:"USD"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["≈ ",e.tokenAmount.toFixed(8)," ",d]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>E(a),className:"text-red-500 hover:text-red-700 dark:hover:text-red-400",disabled:w,children:(0,s.jsx)(ey.A,{size:18})})]},a))}),(0,s.jsxs)("div",{className:"flex justify-between mt-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Your portion (remaining):"}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["≈ ",(v*p).toFixed(8)," ",d]})]}),(0,s.jsxs)("span",{className:"font-medium ".concat(v<0?"text-red-600 dark:text-red-500":"text-green-600 dark:text-green-500"),children:[v.toFixed(2)," USD"]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:w,children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:H,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",disabled:w||x||0===y.length||v<0,children:w?"Creating...":"Create Split Bill"})]})]})})},ep=e=>{let{selectedToken:t}=e,[a,l]=(0,r.useState)([]),[d,i]=(0,r.useState)(!0),[o,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!1),[p,g]=(0,r.useState)(""),[h,f]=(0,r.useState)(0),[v,j]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[C,A]=(0,r.useState)(!1),[F,D]=(0,r.useState)(null),[T,P]=(0,r.useState)(0),[H,M]=(0,r.useState)(!1),{user:_}=(0,$.A)(),z=(0,c.e)(),{sendPayment:L,isLoading:W,resultMessage:J,fetchUserCoins:V,coinObjects:q,setResultMessage:O}=w(t),Y=(0,r.useMemo)(()=>{var e,a;return(null==t?void 0:t.symbol)?t.symbol:(null==z||null==(a=z.chain)||null==(e=a.nativeCurrency)?void 0:e.symbol)?z.chain.nativeCurrency.symbol:"ETH"},[t,z]);(0,r.useEffect)(()=>()=>{O({type:"",message:""}),g("")},[O]),(0,r.useEffect)(()=>{(async()=>{if(t&&z)try{var e;let a,s=(null==(e=z.chain)?void 0:e.id)||1;a="transport"in z&&"url"in z.transport?new U.FR(z.transport.url):new U.FR;let r=await (0,R.E)(a,t.symbol,s);f(r)}catch(e){console.error("Failed to fetch ".concat(Y," exchange rate:"),e),t.symbol.includes("USD")?f(1):f(.001)}})()},[t,z,Y]),(0,r.useEffect)(()=>{if(o&&h>0){let e=parseFloat(o.amount.toString()),a=e*h,s=(null==t?void 0:t.decimals)?Math.min(t.decimals,6):6;k(a.toFixed(s)),j(e.toFixed(2))}else k(""),j("")},[o,h,t]),(0,r.useEffect)(()=>{if(y&&J.type&&o)if("success"===J.type){let e=J.message.match(/Hash: (0x[a-fA-F0-9]+)/),t=e?e[1]:null;t?eo(o._id,"paid",t).then(()=>{l(a.map(e=>e._id===o._id?{...e,paymentStatus:"paid",transactionHash:t}:e)),H||(n.oR.success("Invoice paid successfully!"),M(!0)),setTimeout(()=>{u(!1),m(null),b(!1)},2e3)}).catch(e=>{console.error("Failed to update invoice status:",e),H||(n.oR.error("Payment was successful, but failed to update invoice status"),M(!0)),b(!1),g("Payment successful but invoice update failed. Please contact support.")}):(g("Transaction completed but could not extract transaction hash."),b(!1))}else"error"===J.type&&(g("Payment failed: ".concat(J.message)),b(!1))},[J,y,o,a,H]),(0,r.useEffect)(()=>{(async()=>{if(null==_?void 0:_.email)try{i(!0);let e=await ei(_.email);l(e.data)}catch(e){n.oR.error("Failed to fetch invoices"),console.error(e)}finally{i(!1)}})()},[null==_?void 0:_.email]);let G=e=>{m(e),u(!0),g(""),M(!1)},K=e=>{D(e),A(!0)},Q=(0,r.useCallback)(e=>!!q&&0!==q.length&&!!e&&!!t&&q.reduce((e,t)=>e+Number(t.balance),0)>=parseFloat(e),[q,t]),Z=async()=>{if(!o||!N)return;if(!Q(N))return void g("Insufficient funds to pay this invoice (".concat(N," ").concat(Y,")"));let e="INV-".concat(o._id,"-").concat(Date.now());O({type:"",message:""}),g(""),b(!0);try{await L(e,o.walletAddress,N),V()}catch(e){console.error("Payment failed:",e),g("Failed to initiate payment"),b(!1)}},X=e=>{var t,a;if(!(null==z?void 0:z.chain))return"https://etherscan.io/tx/".concat(e);let s=null==(a=z.chain.blockExplorers)||null==(t=a.default)?void 0:t.url;if(s)return"".concat(s,"/tx/").concat(e);switch(z.chain.id){case 1:default:return"https://etherscan.io/tx/".concat(e);case 137:return"https://polygonscan.com/tx/".concat(e);case 56:return"https://bscscan.com/tx/".concat(e);case 43114:return"https://snowtrace.io/tx/".concat(e);case 42161:return"https://arbiscan.io/tx/".concat(e);case 10:return"https://optimistic.etherscan.io/tx/".concat(e);case 80002:return"https://amoy.polygonscan.com/tx/".concat(e)}},ee=e=>{switch(e){case"pending":return(0,s.jsx)(en.A,{className:"h-5 w-5 text-yellow-500"});case"paid":return(0,s.jsx)(E.A,{className:"h-5 w-5 text-green-500"});case"cancelled":return(0,s.jsx)(B.A,{className:"h-5 w-5 text-red-500"});default:return null}};return d?(0,s.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,s.jsx)(em.A,{className:"animate-spin h-8 w-8"})}):(0,s.jsxs)("div",{className:"mt-4 w-full",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Your Invoices"}),0===a.length?(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"No invoices found"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Invoice #"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"From"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amount (USD)"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Due Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.invoiceNumber}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.createdBy}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.amount," USD"]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.dueDate).toLocaleDateString()}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap flex items-center",children:[ee(e.paymentStatus),(0,s.jsx)("span",{className:"ml-2",children:e.paymentStatus})]}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:["pending"===e.paymentStatus&&(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>G(e),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded",disabled:!e.walletAddress,children:"Pay"}),(0,s.jsxs)("button",{onClick:()=>K(e),className:"border border-blue-600 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 font-medium py-1 px-3 rounded flex items-center",children:[(0,s.jsx)(el.A,{size:16,className:"mr-1"}),"Split"]})]}),"paid"===e.paymentStatus&&e.transactionHash&&(0,s.jsx)("a",{href:X(e.transactionHash),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View Transaction"})]})]},e._id))})]})}),x&&o&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold",children:["Pay Invoice ",o.invoiceNumber]}),!y&&!W&&(0,s.jsx)("button",{onClick:()=>u(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(B.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-md",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"From"}),(0,s.jsx)("p",{className:"font-medium",children:o.createdBy})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(o.dueDate).toLocaleDateString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),(0,s.jsxs)("div",{className:"font-medium flex items-center",children:[ee(o.paymentStatus),(0,s.jsx)("span",{className:"ml-2 capitalize",children:o.paymentStatus})]})]})]}),o.description&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Description"}),(0,s.jsx)("p",{className:"font-medium",children:o.description})]})]}),(0,s.jsx)("div",{className:"p-4 border border-blue-100 dark:border-blue-900 rounded-md",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"USD Amount:"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(S.A,{size:16,className:"text-gray-400 mr-1"}),(0,s.jsx)("span",{className:"text-lg font-bold",children:o.amount})]})]}),h>0&&N&&(0,s.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,s.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[Y," to Pay:"]}),(0,s.jsxs)("span",{className:"text-lg font-bold",children:[N," ",Y]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Exchange Rate: 1 USD = ",h>0?h.toFixed(6):"..."," ",Y]})]})}),(0,s.jsxs)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Recipient Address"}),(0,s.jsx)("p",{className:"font-mono text-sm break-all mt-1",children:o.walletAddress})]}),p?(0,s.jsx)(I,{message:{type:"error",message:p},onDismiss:()=>g("")}):y||W?(0,s.jsx)(I,{message:{type:"info",message:J.message||"Processing your payment..."}}):J.type?(0,s.jsx)(I,{message:J,onDismiss:()=>O({type:"",message:""})}):null]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[!J.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>u(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:W||y,children:"Cancel"}),(0,s.jsx)("button",{onClick:Z,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",disabled:W||y||!Q(N),children:W||y?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(em.A,{className:"animate-spin mr-2 h-4 w-4"}),"Processing..."]}):"Pay ".concat(N," ").concat(Y," (").concat(o.amount," USD)")})]}),"success"===J.type&&(0,s.jsx)("button",{onClick:()=>u(!1),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Close"})]}),o&&!Q(N)&&(0,s.jsxs)("div",{className:"mt-4 text-sm text-red-600 dark:text-red-400",children:[(0,s.jsx)(ex.A,{className:"inline h-4 w-4 mr-1"}),"Insufficient funds to complete this payment"]})]})}),C&&F&&(0,s.jsx)(eb,{invoice:F,onClose:()=>A(!1),onSuccess:()=>{P(e=>e+1),n.oR.success("Invoice split successfully!")},tokenSymbol:Y})]})},eg=()=>{let{user:e}=(0,$.A)(),[t,a]=(0,r.useState)({clientName:"",clientEmail:"",dueDate:"",description:"",amount:"",walletAddress:""}),[l,d]=(0,r.useState)(!1),[i,c]=(0,r.useState)(!0),o=e=>{let{name:t,value:s}=e.target;a(e=>({...e,[t]:s}))},m=async e=>{if(e.preventDefault(),!t.clientEmail||!t.amount||!t.dueDate)return void n.oR.error("Please fill in all required fields");try{var s;d(!0);let e=await ec({...t,amount:parseFloat(t.amount)});if(i&&(null==(s=e.data)?void 0:s._id))try{await (0,F.VR)(e.data._id),n.oR.success("Invoice created and contact added to address book")}catch(e){console.log("Failed to add contact to address book:",e),n.oR.success("Invoice created, but failed to add contact")}else n.oR.success("Invoice created successfully");a({clientName:"",clientEmail:"",dueDate:"",description:"",amount:"",walletAddress:""})}catch(e){console.error("Failed to create invoice:",e),n.oR.error("Failed to create invoice")}finally{d(!1)}};return e?(0,s.jsx)("div",{className:"p-4 rounded-lg mt-10",children:(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"clientName",className:"block text-sm font-medium mb-1",children:"Client Name"}),(0,s.jsx)("input",{type:"text",id:"clientName",name:"clientName",value:t.clientName,onChange:o,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"clientEmail",className:"block text-sm font-medium mb-1",children:"Client Email *"}),(0,s.jsx)("input",{type:"email",id:"clientEmail",name:"clientEmail",value:t.clientEmail,onChange:o,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium mb-1",children:"Amount *"}),(0,s.jsx)("input",{type:"number",id:"amount",name:"amount",value:t.amount,onChange:o,min:"0.000000001",step:"0.000000001",className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium mb-1",children:"Due Date *"}),(0,s.jsx)("input",{type:"date",id:"dueDate",name:"dueDate",value:t.dueDate,onChange:o,min:new Date().toISOString().split("T")[0],className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium mb-1",children:"Your Wallet Address (to receive payment)"}),(0,s.jsx)("input",{type:"text",id:"walletAddress",name:"walletAddress",value:t.walletAddress,onChange:o,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",placeholder:"0x..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium mb-1",children:"Description"}),(0,s.jsx)("textarea",{id:"description",name:"description",value:t.description,onChange:o,rows:3,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"addToAddressBook",checked:i,onChange:e=>{c(e.target.checked)},className:"mr-2 h-4 w-4"}),(0,s.jsx)("label",{htmlFor:"addToAddressBook",className:"text-sm text-gray-700 dark:text-gray-300",children:"Add client to address book"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400",children:l?"Creating...":"Create Invoice"})})]})}):(0,s.jsx)("div",{className:"p-4 text-center",children:"Please sign in to create invoices."})};var eh=a(63439),ef=a(57340),ev=a(6874),ej=a.n(ev),eN=a(72883),ek=a(53999);let ew=eN.bL,eC=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.B8,{ref:t,className:(0,ek.cn)("inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",a),...r})});eC.displayName=eN.B8.displayName;let eA=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.l9,{ref:t,className:(0,ek.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-800 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",a),...r})});eA.displayName=eN.l9.displayName;let eS=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.UC,{ref:t,className:(0,ek.cn)("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-800",a),...r})});eS.displayName=eN.UC.displayName;let eF=function(){let{address:e}=(0,i.F)(),t=(0,C.i)(),[a,n]=(0,r.useState)(void 0),[l,d]=(0,r.useState)(0);return(0,r.useEffect)(()=>{if(t){let e=j[t];e&&e.length>0&&n(e[0])}},[t]),(0,s.jsxs)("div",{className:"relative h-screen w-screen dark:text-white text-black p-6 z-10",children:[(0,s.jsx)("div",{className:"absolute top-4 left-4",children:(0,s.jsx)(ej(),{href:"/",children:(0,s.jsx)(ef.A,{className:"text-black dark:hover:text-gray-200 hover:text-gray-800 dark:text-white",size:30})})}),(0,s.jsxs)("div",{className:"flex flex-col max-w-screen max-h-screen items-center m-10",children:[(0,s.jsxs)("div",{className:"w-full flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"PayZoll P2P Payments"}),(0,s.jsx)(eh.pK,{})]}),e?a?(0,s.jsxs)(ew,{defaultValue:"transfer",className:"min-w-[90%]",children:[(0,s.jsxs)(eC,{className:"grid w-full grid-cols-4",children:[(0,s.jsx)(eA,{value:"transfer",children:"Secure Transfer"}),(0,s.jsx)(eA,{value:"invoices",children:"My Invoices"}),(0,s.jsx)(eA,{value:"splitbills",children:"Split Bills"}),(0,s.jsx)(eA,{value:"create-invoice",children:"Create Invoice"})]}),(0,s.jsx)(eS,{value:"transfer",children:(0,s.jsx)(X,{selectedToken:a})}),(0,s.jsx)(eS,{value:"invoices",children:(0,s.jsx)(ep,{selectedToken:a})}),(0,s.jsx)(eS,{value:"splitbills",children:(0,s.jsx)(ed,{selectedToken:a,refreshTrigger:l})}),(0,s.jsx)(eS,{value:"create-invoice",children:(0,s.jsx)(eg,{})})]}):(0,s.jsx)("div",{className:"dark:text-white text-black border-2 border-blue-200 p-4 rounded-md",children:(0,s.jsx)("p",{children:"No compatible tokens found for the current chain. Please switch networks."})}):(0,s.jsx)("div",{className:"dark:text-white text-black border-2 border-blue-200 p-4 rounded-md",children:(0,s.jsx)("p",{children:"Please connect your wallet to use these features."})})]})]})}},58575:(e,t,a)=>{Promise.resolve().then(a.bind(a,52883))}},e=>{var t=t=>e(e.s=t);e.O(0,[8451,844,4134,3464,4277,9125,2901,8021,9321,1312,5196,376,8441,1684,7358],()=>t(58575)),_N_E=e.O()}]);